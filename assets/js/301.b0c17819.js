"use strict";(globalThis.webpackChunkphysical_ai_robotics_book=globalThis.webpackChunkphysical_ai_robotics_book||[]).push([[301],{9301:(e,t,s)=>{s.r(t),s.d(t,{Chatbot:()=>I,default:()=>L});var n=s(6540);const a={chatIcon:"chatIcon_mNJO",chatIconSvg:"chatIconSvg_Ml98",chatIconClose:"chatIconClose_wY9S",chatIconLoading:"chatIconLoading_COS2",chatPanel:"chatPanel_YkPL",slideUp:"slideUp_F8OC",panelHeader:"panelHeader_vvSE",panelTitle:"panelTitle_mYsh",headerActions:"headerActions__Ajm",logoutButton:"logoutButton_gBKt",closeButton:"closeButton_XR2n",messagesContainer:"messagesContainer_MjDf",message:"message_aF95",messageUser:"messageUser_RSIK",messageAssistant:"messageAssistant_zw50",messageError:"messageError_RPin",citation:"citation_wSbP",sourceList:"sourceList_r1Ep",sourceListTitle:"sourceListTitle_Qe2h",sourceItem:"sourceItem_wvyK",sourceNumber:"sourceNumber_URFQ",sourceContent:"sourceContent_WSlZ",sourceLink:"sourceLink_y9zi",inputArea:"inputArea_etJG",inputWrapper:"inputWrapper_O86M",textInput:"textInput_NibH",submitButton:"submitButton_jEAc",loadingIndicator:"loadingIndicator_Mbk9",loadingDots:"loadingDots_bHrE",loadingDot:"loadingDot_Vbex",bounce:"bounce_h5a7",welcomeContainer:"welcomeContainer_hQW8",welcomeTitle:"welcomeTitle_BLQx",welcomeText:"welcomeText_bDpf",exampleQuestions:"exampleQuestions_ULh9",exampleQuestion:"exampleQuestion_yiZs",errorContainer:"errorContainer_XB4r",errorText:"errorText_MZIN",retryButton:"retryButton_ZZIV",contextPreview:"contextPreview_kLoV",contextLabel:"contextLabel_WqYs",contextText:"contextText_WpZu",fadeIn:"fadeIn_UgSW",markdownContent:"markdownContent_cRxk",markdownParagraph:"markdownParagraph_KR_N",markdownHeader:"markdownHeader_XWPc",markdownList:"markdownList_s3rD",markdownLink:"markdownLink_CztZ",codeBlock:"codeBlock_SNiy",inlineCode:"inlineCode_TfqH",citationMarker:"citationMarker_XknM",referencesContainer:"referencesContainer_MLNX",referencesToggle:"referencesToggle_fd_U",referencesIcon:"referencesIcon_pPgM",referencesContent:"referencesContent_Hksj",referenceItem:"referenceItem_KI4p",referenceNumber:"referenceNumber_N0Mm",referenceLink:"referenceLink_b7W_",referenceTiming:"referenceTiming_jze4"};var r=s(4848);function o(){return(0,r.jsx)("svg",{className:a.chatIconSvg,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}function l(){return(0,r.jsx)("span",{className:a.chatIconClose,"aria-hidden":"true",children:"\xd7"})}const c=function({isOpen:e,onClick:t,isLoading:s=!1}){return(0,r.jsx)("button",{className:`${a.chatIcon} ${s?a.chatIconLoading:""}`,onClick:t,"aria-label":e?"Close chat":"Open chat","aria-expanded":e,type:"button",disabled:s,children:e?(0,r.jsx)(l,{}):(0,r.jsx)(o,{})})};function i(e){if(!e)return null;const t=[];let s=0;const n=/```(\w*)\n?([\s\S]*?)```/g;let o,l=0;const c=[];for(;null!==(o=n.exec(e));)o.index>l&&c.push({type:"text",content:e.slice(l,o.index)}),c.push({type:"codeblock",language:o[1]||"",content:o[2].trim()}),l=o.index+o[0].length;return l<e.length&&c.push({type:"text",content:e.slice(l)}),c.forEach((e,n)=>{if("codeblock"===e.type)t.push((0,r.jsx)("pre",{className:a.codeBlock,children:(0,r.jsx)("code",{className:e.language?a[`language-${e.language}`]:"",children:e.content})},s++));else{const n=e.content.split("\n");let o=!1,l=[];n.forEach((e,c)=>{const i=e.trim(),d=i.match(/^(\d+\.|[-*])\s+(.+)$/);if(d)o||(o=!0,l=[]),l.push(u(d[2],s++));else if(o&&l.length>0&&(t.push((0,r.jsx)("ul",{className:a.markdownList,children:l.map((e,t)=>(0,r.jsx)("li",{children:e},t))},s++)),o=!1,l=[]),""===i)c>0&&c<n.length-1&&t.push((0,r.jsx)("br",{},s++));else{const e=i.match(/^(#{1,6})\s+(.+)$/);if(e){const n=e[1].length,o=`h${Math.min(n+2,6)}`;t.push((0,r.jsx)(o,{className:a.markdownHeader,children:u(e[2],s++)},s++))}else t.push((0,r.jsx)("p",{className:a.markdownParagraph,children:u(i,s++)},s++))}}),o&&l.length>0&&t.push((0,r.jsx)("ul",{className:a.markdownList,children:l.map((e,t)=>(0,r.jsx)("li",{children:e},t))},s++))}}),t}function u(e,t=0){if(!e)return e;const s=[];let n=t;const o=/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*|\[[^\]]+\]\([^)]+\)|\[(\d+)\])/g;let l,c=0;for(;null!==(l=o.exec(e));){l.index>c&&s.push(e.slice(c,l.index));const t=l[0];if(t.startsWith("`")&&t.endsWith("`"))s.push((0,r.jsx)("code",{className:a.inlineCode,children:t.slice(1,-1)},n++));else if(t.startsWith("**")&&t.endsWith("**"))s.push((0,r.jsx)("strong",{children:t.slice(2,-2)},n++));else if(t.startsWith("*")&&t.endsWith("*"))s.push((0,r.jsx)("em",{children:t.slice(1,-1)},n++));else if(t.startsWith("[")&&t.includes("](")){const e=t.match(/\[([^\]]+)\]\(([^)]+)\)/);e&&s.push((0,r.jsx)("a",{href:e[2],target:"_blank",rel:"noopener noreferrer",className:a.markdownLink,children:e[1]},n++))}else/^\[\d+\]$/.test(t)&&s.push((0,r.jsx)("span",{className:a.citationMarker,children:t},n++));c=l.index+t.length}return c<e.length&&s.push(e.slice(c)),s.length>0?s:e}function d({sources:e,timing:t}){const[s,o]=(0,n.useState)(!1);return e&&0!==e.length?(0,r.jsxs)("div",{className:a.referencesContainer,children:[(0,r.jsxs)("button",{className:a.referencesToggle,onClick:()=>o(!s),type:"button","aria-expanded":s,children:[(0,r.jsx)("span",{className:a.referencesIcon,children:s?"\u25bc":"\u25b6"}),"References (",e.length,")"]}),s&&(0,r.jsxs)("div",{className:a.referencesContent,children:[e.map((e,t)=>(0,r.jsxs)("div",{className:a.referenceItem,children:[(0,r.jsxs)("span",{className:a.referenceNumber,children:["[",t+1,"]"]}),(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:a.referenceLink,children:h(e.url)})]},t)),t&&(0,r.jsxs)("div",{className:a.referenceTiming,children:["Retrieved in ",Math.round(t.retrieval_time_ms),"ms | Generated in ",Math.round(t.generation_time_ms),"ms"]})]})]}):null}function h(e){try{const t=new URL(e),s=t.pathname.split("/").filter(Boolean);if(s.length>0){return s[s.length-1].replace(/\.(html|md|mdx)$/i,"").replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return t.hostname}catch{return e}}const m=function({message:e}){const{role:t,content:s,sources:n,timing:o,error:l}=e,c="user"===t,u=!!l,h=[a.message,c?a.messageUser:a.messageAssistant,u&&a.messageError].filter(Boolean).join(" ");return(0,r.jsx)("div",{className:h,role:"article","aria-label":`${t} message`,children:u?(0,r.jsx)("span",{children:l}):c?(0,r.jsx)("span",{children:s}):(0,r.jsxs)("div",{className:a.markdownContent,children:[i(s),(0,r.jsx)(d,{sources:n,timing:o})]})})};var g=s(6588),p=s(9427);const x={400:"Invalid request. Please try rephrasing your question.",401:"Authentication required. Please sign in.",404:"Service not found. Please try again later.",422:"Unable to process your question. Please try rephrasing.",429:"Too many requests. Please wait a moment and try again.",500:"Server error. Please try again later.",503:"Service temporarily unavailable. Please try again later.",timeout:"Request timed out. Please try again.",network:"Unable to connect to the server. Please check your connection.",default:"An unexpected error occurred. Please try again."};function f(e,t){return"AbortError"===e?.name?x.timeout:e?.message?.includes("Failed to fetch")||e?.message?.includes("NetworkError")?x.network:x[t]||x.default}function b(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null),{user:r}=(0,p.As)();let o="http://localhost:8000";try{const e=(0,g.P_)("docusaurus-plugin-chatbot");e?.apiUrl&&(o=e.apiUrl)}catch{}const l=(0,n.useCallback)(e=>{if(!e)return null;let t=[];try{e.technologies&&(t=JSON.parse(e.technologies))}catch{t=[]}return{programming_level:e.programmingLevel||"beginner",technologies:t,hardware_access:e.hardwareAccess||"none"}},[]);return{askQuestion:(0,n.useCallback)(async(e,s,n=5)=>{t(!0),a(null);const c=l(r),i=r?.id;if(!i||!c){const e=x[401];throw a(e),new Error(e)}const u=new AbortController,d=setTimeout(()=>u.abort(),3e4);try{const t=await fetch(`${o}/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,...s&&{context:s},top_k:n,user_id:i,user_profile:c}),signal:u.signal});if(clearTimeout(d),!t.ok){const e=await t.json().catch(()=>({})),s=f(null,t.status);throw a(s),new Error(e.detail||s)}return await t.json()}catch(h){clearTimeout(d);const e=f(h,null);throw a(e),h}finally{t(!1)}},[o,r,l]),checkHealth:(0,n.useCallback)(async()=>{try{return(await fetch(`${o}/health`,{method:"GET"})).ok}catch{return!1}},[o]),isLoading:e,error:s,clearError:(0,n.useCallback)(()=>{a(null)},[])}}const k="rag-chatbot-session";function _(){const e=Date.now();return{messages:[],createdAt:e,lastUpdatedAt:e}}function C(){const[e,t]=(0,n.useState)(_),[s,a]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=function(){try{const e=sessionStorage.getItem(k);if(e){const t=JSON.parse(e);if(t&&Array.isArray(t.messages))return t}}catch(e){console.warn("Failed to read chat session from storage:",e)}return null}();e&&t(e),a(!0)},[]),(0,n.useEffect)(()=>{s&&function(e){try{sessionStorage.setItem(k,JSON.stringify(e))}catch(t){console.warn("Failed to save chat session to storage:",t)}}(e)},[e,s]);const r=(0,n.useCallback)(e=>{const s={...e,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};return t(e=>({...e,messages:[...e.messages,s],lastUpdatedAt:Date.now()})),s},[]),o=(0,n.useCallback)(e=>{t(t=>{const s=[...t.messages];for(let n=s.length-1;n>=0;n--)if("assistant"===s[n].role){s[n]={...s[n],...e};break}return{...t,messages:s,lastUpdatedAt:Date.now()}})},[]),l=(0,n.useCallback)(()=>{const e=_();t(e);try{sessionStorage.removeItem(k)}catch(s){console.warn("Failed to clear session storage:",s)}},[]),c=e.messages.length;return{messages:e.messages,addMessage:r,updateLastAssistantMessage:o,clearSession:l,isLoaded:s,messageCount:c}}var w=s(711);const j=["What is ROS 2?","How do I create a robot model with URDF?","What is the difference between Gazebo and Isaac Sim?"];function y(){return(0,r.jsxs)("div",{className:a.loadingIndicator,"aria-live":"polite",children:[(0,r.jsxs)("div",{className:a.loadingDots,children:[(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot})]}),(0,r.jsx)("span",{children:"Thinking..."})]})}function N({onQuestionClick:e}){return(0,r.jsxs)("div",{className:a.welcomeContainer,children:[(0,r.jsx)("h3",{className:a.welcomeTitle,children:"Ask me anything about the book!"}),(0,r.jsx)("p",{className:a.welcomeText,children:"I can help you understand Physical AI, ROS 2, robotics simulation, and more."}),(0,r.jsx)("div",{className:a.exampleQuestions,children:j.map((t,s)=>(0,r.jsx)("button",{className:a.exampleQuestion,onClick:()=>e(t),type:"button",children:t},s))})]})}function v({context:e,onClear:t}){if(!e)return null;const s=e.length>150?e.slice(0,150)+"...":e;return(0,r.jsxs)("div",{className:a.contextPreview,children:[(0,r.jsxs)("div",{className:a.contextLabel,children:["Selected text context:",(0,r.jsx)("button",{onClick:t,style:{marginLeft:"8px",background:"none",border:"none",cursor:"pointer",color:"inherit",textDecoration:"underline"},type:"button",children:"Clear"})]}),(0,r.jsx)("div",{className:a.contextText,children:s})]})}const S=function({onClose:e,selectedContext:t,onClearContext:s}){const[o,l]=(0,n.useState)(""),[c,i]=(0,n.useState)(null),[u,d]=(0,n.useState)(!1),h=(0,n.useRef)(null),g=(0,n.useRef)(null),{messages:x,addMessage:f,isLoaded:k}=C(),{askQuestion:_,isLoading:j,error:S,clearError:I}=b(),{user:L}=(0,p.As)(),T=(0,n.useCallback)(async()=>{d(!0);try{await(0,w.CI)(),e()}catch(t){console.error("Logout failed:",t)}finally{d(!1)}},[e]);(0,n.useEffect)(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[x,j]),(0,n.useEffect)(()=>{g.current?.focus()},[]);const A=(0,n.useCallback)(t=>{"Escape"===t.key&&e()},[e]),P=(0,n.useCallback)(async()=>{const e=o.trim();if(e&&!j){l(""),I(),i(null),f({role:"user",content:e});try{const n=await _(e,t);f({role:"assistant",content:n.answer,sources:n.sources,timing:{retrieval_time_ms:n.retrieval_time_ms,generation_time_ms:n.generation_time_ms}}),t&&s&&s()}catch(n){i(e),f({role:"assistant",content:"",error:S||"Failed to get response. Please try again."})}}},[o,j,_,f,t,s,I,S]),E=(0,n.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},[P]),B=(0,n.useCallback)(e=>{l(e),setTimeout(()=>{g.current?.focus()},100)},[]),D=(0,n.useCallback)(()=>{c&&(l(c),i(null),I())},[c,I]),M=0===x.length&&!j,U=o.trim().length>0&&!j;return(0,r.jsxs)("div",{className:a.chatPanel,role:"dialog","aria-label":"Chat with AI assistant",onKeyDown:A,children:[(0,r.jsxs)("div",{className:a.panelHeader,children:[(0,r.jsx)("h2",{className:a.panelTitle,children:"Ask about the book"}),(0,r.jsxs)("div",{className:a.headerActions,children:[(0,r.jsx)("button",{className:a.logoutButton,onClick:T,disabled:u,"aria-label":"Sign out",type:"button",title:L?.email||"Sign out",children:u?"...":"Sign out"}),(0,r.jsx)("button",{className:a.closeButton,onClick:e,"aria-label":"Close chat panel",type:"button",children:(0,r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]})]}),(0,r.jsxs)("div",{className:a.messagesContainer,role:"log","aria-live":"polite",children:[M&&!t?(0,r.jsx)(N,{onQuestionClick:B}):(0,r.jsx)(r.Fragment,{children:x.map((e,t)=>(0,r.jsx)(m,{message:e},e.id||t))}),j&&(0,r.jsx)(y,{}),S&&c&&(0,r.jsxs)("div",{className:a.errorContainer,children:[(0,r.jsx)("div",{className:a.errorText,children:S}),(0,r.jsx)("button",{className:a.retryButton,onClick:D,type:"button",children:"Retry"})]}),(0,r.jsx)("div",{ref:h})]}),(0,r.jsxs)("div",{className:a.inputArea,children:[(0,r.jsx)(v,{context:t,onClear:s}),(0,r.jsxs)("div",{className:a.inputWrapper,children:[(0,r.jsx)("textarea",{ref:g,className:a.textInput,value:o,onChange:e=>l(e.target.value),onKeyDown:E,placeholder:"Ask a question...","aria-label":"Type your question",rows:1,disabled:j}),(0,r.jsx)("button",{className:a.submitButton,onClick:P,disabled:!U,"aria-label":"Send message",type:"button",children:"Send"})]})]})]})};function I(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null),[o,l]=(0,n.useState)(!1),{isAuthenticated:i,isProfileComplete:u,isPending:d}=(0,p.As)(),h=(0,n.useCallback)(()=>{d||(i&&u?t(e=>!e):l(!0))},[i,u,d]),m=(0,n.useCallback)(()=>{t(!1)},[]),g=(0,n.useCallback)(()=>{l(!1)},[]),x=(0,n.useCallback)(()=>{l(!1)},[]),f=(0,n.useCallback)(e=>{d||(i&&u?(a(e),t(!0)):l(!0))},[i,u,d]),b=(0,n.useCallback)(()=>{a(null)},[]);return(0,n.useEffect)(()=>(window.__chatbotSetContext=f,()=>{delete window.__chatbotSetContext}),[f]),(0,n.useEffect)(()=>{const t=t=>{"Escape"===t.key&&(o?l(!1):e&&m())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,o,m]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{isOpen:e,onClick:h,isLoading:d}),e&&i&&u&&(0,r.jsx)(S,{onClose:m,selectedContext:s,onClearContext:b}),(0,r.jsx)(p.Ux,{isOpen:o,onClose:g,onSuccess:x})]})}const L=I}}]);