"use strict";(globalThis.webpackChunkphysical_ai_robotics_book=globalThis.webpackChunkphysical_ai_robotics_book||[]).push([[616],{2235:(e,t,s)=>{s.r(t),s.d(t,{Chatbot:()=>v,default:()=>N});var n=s(6540);const a={chatIcon:"chatIcon_mNJO",chatIconSvg:"chatIconSvg_Ml98",chatIconClose:"chatIconClose_wY9S",chatPanel:"chatPanel_YkPL",slideUp:"slideUp_F8OC",panelHeader:"panelHeader_vvSE",panelTitle:"panelTitle_mYsh",closeButton:"closeButton_XR2n",messagesContainer:"messagesContainer_MjDf",message:"message_aF95",messageUser:"messageUser_RSIK",messageAssistant:"messageAssistant_zw50",messageError:"messageError_RPin",citation:"citation_wSbP",sourceList:"sourceList_r1Ep",sourceListTitle:"sourceListTitle_Qe2h",sourceItem:"sourceItem_wvyK",sourceNumber:"sourceNumber_URFQ",sourceContent:"sourceContent_WSlZ",sourceLink:"sourceLink_y9zi",inputArea:"inputArea_etJG",inputWrapper:"inputWrapper_O86M",textInput:"textInput_NibH",submitButton:"submitButton_jEAc",loadingIndicator:"loadingIndicator_Mbk9",loadingDots:"loadingDots_bHrE",loadingDot:"loadingDot_Vbex",bounce:"bounce_h5a7",welcomeContainer:"welcomeContainer_hQW8",welcomeTitle:"welcomeTitle_BLQx",welcomeText:"welcomeText_bDpf",exampleQuestions:"exampleQuestions_ULh9",exampleQuestion:"exampleQuestion_yiZs",errorContainer:"errorContainer_XB4r",errorText:"errorText_MZIN",retryButton:"retryButton_ZZIV",contextPreview:"contextPreview_kLoV",contextLabel:"contextLabel_WqYs",contextText:"contextText_WpZu",fadeIn:"fadeIn_UgSW"};var r=s(4848);function o(){return(0,r.jsx)("svg",{className:a.chatIconSvg,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}function l(){return(0,r.jsx)("span",{className:a.chatIconClose,"aria-hidden":"true",children:"\xd7"})}const i=function({isOpen:e,onClick:t}){return(0,r.jsx)("button",{className:a.chatIcon,onClick:t,"aria-label":e?"Close chat":"Open chat","aria-expanded":e,type:"button",children:e?(0,r.jsx)(l,{}):(0,r.jsx)(o,{})})};const c=function({message:e}){const{role:t,content:s,sources:n,error:o}=e,l="user"===t,i=!!o,c=[a.message,l?a.messageUser:a.messageAssistant,i&&a.messageError].filter(Boolean).join(" "),u=l?s:function(e,t=[]){if(!e||!t.length)return[e];const s=/\[(\d+)\]/g,n=[];let o,l=0;for(;null!==(o=s.exec(e));){o.index>l&&n.push(e.slice(l,o.index));const s=parseInt(o[1],10),i=t[s-1];i&&i.url?n.push((0,r.jsxs)("a",{href:i.url,className:a.citation,target:"_blank",rel:"noopener noreferrer",title:`Source ${s}: ${i.content?.slice(0,100)||i.url}`,children:["[",s,"]"]},`citation-${o.index}`)):n.push(o[0]),l=o.index+o[0].length}return l<e.length&&n.push(e.slice(l)),n.length>0?n:[e]}(s,n);return(0,r.jsx)("div",{className:c,role:"article","aria-label":`${t} message`,children:i?(0,r.jsx)("span",{children:o}):(0,r.jsx)("span",{children:u})})};function u(e,t=100){return!e||e.length<=t?e:e.slice(0,t).trim()+"..."}function d(e){try{const t=new URL(e),s=t.pathname.split("/").filter(Boolean);if(s.length>0){return s[s.length-1].replace(/\.(html|md|mdx)$/i,"").replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return t.hostname}catch{return e}}const m=function({sources:e,timing:t}){return e&&0!==e.length?(0,r.jsxs)("div",{className:a.sourceList,children:[(0,r.jsx)("div",{className:a.sourceListTitle,children:"Sources"}),e.map((e,t)=>(0,r.jsxs)("div",{className:a.sourceItem,children:[(0,r.jsxs)("span",{className:a.sourceNumber,children:["[",t+1,"]"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("a",{href:e.url,className:a.sourceLink,target:"_blank",rel:"noopener noreferrer",children:d(e.url)}),e.content&&(0,r.jsx)("div",{className:a.sourceContent,children:u(e.content,120)})]})]},t)),t&&(0,r.jsxs)("div",{className:a.sourceContent,style:{marginTop:"8px",fontSize:"11px"},children:["Retrieved in ",t.retrieval_time_ms,"ms | Generated in ",t.generation_time_ms,"ms"]})]}):null};var h=s(6588);const g={400:"Invalid request. Please try rephrasing your question.",404:"Service not found. Please try again later.",422:"Unable to process your question. Please try rephrasing.",429:"Too many requests. Please wait a moment and try again.",500:"Server error. Please try again later.",503:"Service temporarily unavailable. Please try again later.",timeout:"Request timed out. Please try again.",network:"Unable to connect to the server. Please check your connection.",default:"An unexpected error occurred. Please try again."};function x(e,t){return"AbortError"===e?.name?g.timeout:e?.message?.includes("Failed to fetch")||e?.message?.includes("NetworkError")?g.network:g[t]||g.default}function p(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null);let r="http://localhost:8000";try{const e=(0,h.P_)("docusaurus-plugin-chatbot");e?.apiUrl&&(r=e.apiUrl)}catch{}return{askQuestion:(0,n.useCallback)(async(e,s,n=5)=>{t(!0),a(null);const o=new AbortController,l=setTimeout(()=>o.abort(),3e4);try{const t=await fetch(`${r}/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,...s&&{context:s},top_k:n}),signal:o.signal});if(clearTimeout(l),!t.ok){const e=await t.json().catch(()=>({})),s=x(null,t.status);throw a(s),new Error(e.detail||s)}return await t.json()}catch(i){clearTimeout(l);const e=x(i,null);throw a(e),i}finally{t(!1)}},[r]),checkHealth:(0,n.useCallback)(async()=>{try{return(await fetch(`${r}/health`,{method:"GET"})).ok}catch{return!1}},[r]),isLoading:e,error:s,clearError:(0,n.useCallback)(()=>{a(null)},[])}}const b="rag-chatbot-session";function f(){const e=Date.now();return{messages:[],createdAt:e,lastUpdatedAt:e}}function _(){const[e,t]=(0,n.useState)(f),[s,a]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=function(){try{const e=sessionStorage.getItem(b);if(e){const t=JSON.parse(e);if(t&&Array.isArray(t.messages))return t}}catch(e){console.warn("Failed to read chat session from storage:",e)}return null}();e&&t(e),a(!0)},[]),(0,n.useEffect)(()=>{s&&function(e){try{sessionStorage.setItem(b,JSON.stringify(e))}catch(t){console.warn("Failed to save chat session to storage:",t)}}(e)},[e,s]);const r=(0,n.useCallback)(e=>{const s={...e,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};return t(e=>({...e,messages:[...e.messages,s],lastUpdatedAt:Date.now()})),s},[]),o=(0,n.useCallback)(e=>{t(t=>{const s=[...t.messages];for(let n=s.length-1;n>=0;n--)if("assistant"===s[n].role){s[n]={...s[n],...e};break}return{...t,messages:s,lastUpdatedAt:Date.now()}})},[]),l=(0,n.useCallback)(()=>{const e=f();t(e);try{sessionStorage.removeItem(b)}catch(s){console.warn("Failed to clear session storage:",s)}},[]),i=e.messages.length;return{messages:e.messages,addMessage:r,updateLastAssistantMessage:o,clearSession:l,isLoaded:s,messageCount:i}}const C=["What is ROS 2?","How do I create a robot model with URDF?","What is the difference between Gazebo and Isaac Sim?"];function j(){return(0,r.jsxs)("div",{className:a.loadingIndicator,"aria-live":"polite",children:[(0,r.jsxs)("div",{className:a.loadingDots,children:[(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot})]}),(0,r.jsx)("span",{children:"Thinking..."})]})}function k({onQuestionClick:e}){return(0,r.jsxs)("div",{className:a.welcomeContainer,children:[(0,r.jsx)("h3",{className:a.welcomeTitle,children:"Ask me anything about the book!"}),(0,r.jsx)("p",{className:a.welcomeText,children:"I can help you understand Physical AI, ROS 2, robotics simulation, and more."}),(0,r.jsx)("div",{className:a.exampleQuestions,children:C.map((t,s)=>(0,r.jsx)("button",{className:a.exampleQuestion,onClick:()=>e(t),type:"button",children:t},s))})]})}function y({context:e,onClear:t}){if(!e)return null;const s=e.length>150?e.slice(0,150)+"...":e;return(0,r.jsxs)("div",{className:a.contextPreview,children:[(0,r.jsxs)("div",{className:a.contextLabel,children:["Selected text context:",(0,r.jsx)("button",{onClick:t,style:{marginLeft:"8px",background:"none",border:"none",cursor:"pointer",color:"inherit",textDecoration:"underline"},type:"button",children:"Clear"})]}),(0,r.jsx)("div",{className:a.contextText,children:s})]})}const w=function({onClose:e,selectedContext:t,onClearContext:s}){const[o,l]=(0,n.useState)(""),[i,u]=(0,n.useState)(null),d=(0,n.useRef)(null),h=(0,n.useRef)(null),{messages:g,addMessage:x,isLoaded:b}=_(),{askQuestion:f,isLoading:C,error:w,clearError:v}=p();(0,n.useEffect)(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[g,C]),(0,n.useEffect)(()=>{h.current?.focus()},[]);const N=(0,n.useCallback)(t=>{"Escape"===t.key&&e()},[e]),S=(0,n.useCallback)(async()=>{const e=o.trim();if(e&&!C){l(""),v(),u(null),x({role:"user",content:e});try{const n=await f(e,t);x({role:"assistant",content:n.answer,sources:n.sources,timing:{retrieval_time_ms:n.retrieval_time_ms,generation_time_ms:n.generation_time_ms}}),t&&s&&s()}catch(n){u(e),x({role:"assistant",content:"",error:w||"Failed to get response. Please try again."})}}},[o,C,f,x,t,s,v,w]),I=(0,n.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},[S]),T=(0,n.useCallback)(e=>{l(e),setTimeout(()=>{h.current?.focus()},100)},[]),L=(0,n.useCallback)(()=>{i&&(l(i),u(null),v())},[i,v]),E=0===g.length&&!C,A=o.trim().length>0&&!C;return(0,r.jsxs)("div",{className:a.chatPanel,role:"dialog","aria-label":"Chat with AI assistant",onKeyDown:N,children:[(0,r.jsxs)("div",{className:a.panelHeader,children:[(0,r.jsx)("h2",{className:a.panelTitle,children:"Ask about the book"}),(0,r.jsx)("button",{className:a.closeButton,onClick:e,"aria-label":"Close chat panel",type:"button",children:(0,r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),(0,r.jsxs)("div",{className:a.messagesContainer,role:"log","aria-live":"polite",children:[E&&!t?(0,r.jsx)(k,{onQuestionClick:T}):(0,r.jsx)(r.Fragment,{children:g.map((e,t)=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(c,{message:e}),"assistant"===e.role&&e.sources&&e.sources.length>0&&(0,r.jsx)(m,{sources:e.sources,timing:e.timing})]},e.id||t))}),C&&(0,r.jsx)(j,{}),w&&i&&(0,r.jsxs)("div",{className:a.errorContainer,children:[(0,r.jsx)("div",{className:a.errorText,children:w}),(0,r.jsx)("button",{className:a.retryButton,onClick:L,type:"button",children:"Retry"})]}),(0,r.jsx)("div",{ref:d})]}),(0,r.jsxs)("div",{className:a.inputArea,children:[(0,r.jsx)(y,{context:t,onClear:s}),(0,r.jsxs)("div",{className:a.inputWrapper,children:[(0,r.jsx)("textarea",{ref:h,className:a.textInput,value:o,onChange:e=>l(e.target.value),onKeyDown:I,placeholder:"Ask a question...","aria-label":"Type your question",rows:1,disabled:C}),(0,r.jsx)("button",{className:a.submitButton,onClick:S,disabled:!A,"aria-label":"Send message",type:"button",children:"Send"})]})]})]})};function v(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null),o=(0,n.useCallback)(()=>{t(e=>!e)},[]),l=(0,n.useCallback)(()=>{t(!1)},[]),c=(0,n.useCallback)(e=>{a(e),t(!0)},[]),u=(0,n.useCallback)(()=>{a(null)},[]);return(0,n.useEffect)(()=>(window.__chatbotSetContext=c,()=>{delete window.__chatbotSetContext}),[c]),(0,n.useEffect)(()=>{const t=t=>{"Escape"===t.key&&e&&l()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,l]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i,{isOpen:e,onClick:o}),e&&(0,r.jsx)(w,{onClose:l,selectedContext:s,onClearContext:u})]})}const N=v}}]);