openapi: 3.0.3
info:
  title: Better Auth API
  description: |
    Authentication API endpoints provided by Better Auth server.
    These endpoints are auto-generated by Better Auth and should not be modified.
  version: 1.0.0
  contact:
    name: AI Book Project

servers:
  - url: https://auth.your-domain.com/api/auth
    description: Production Auth Server
  - url: http://localhost:3001/api/auth
    description: Local Development

tags:
  - name: Authentication
    description: Sign up, sign in, sign out operations
  - name: Session
    description: Session management
  - name: User
    description: User profile operations

paths:
  /sign-up/email:
    post:
      tags:
        - Authentication
      summary: Register new user with email and profile
      description: |
        Creates a new user account with email/password authentication.
        Profile fields (programmingLevel, technologies, etc.) are required
        to enforce atomic signup (FR-022).
      operationId: signUpEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
            example:
              email: "user@example.com"
              password: "securePassword123"
              name: "John Doe"
              programmingLevel: "intermediate"
              technologies: '["Python", "ROS2"]'
              aiRoboticsExperience: true
              hardwareAccess: "simulator_only"
              devicesOwned: '["Jetson"]'
      responses:
        '200':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
          headers:
            Set-Cookie:
              description: Session cookie
              schema:
                type: string
        '400':
          description: Invalid input or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sign-in/email:
    post:
      tags:
        - Authentication
      summary: Authenticate existing user
      description: Signs in a user with email and password credentials.
      operationId: signInEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
            example:
              email: "user@example.com"
              password: "securePassword123"
              rememberMe: true
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
          headers:
            Set-Cookie:
              description: Session cookie
              schema:
                type: string
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sign-out:
    post:
      tags:
        - Authentication
      summary: End user session
      description: Signs out the current user and invalidates their session.
      operationId: signOut
      security:
        - sessionCookie: []
      responses:
        '200':
          description: Successfully signed out
          headers:
            Set-Cookie:
              description: Cleared session cookie
              schema:
                type: string
        '401':
          description: Not authenticated

  /get-session:
    get:
      tags:
        - Session
      summary: Get current session
      description: |
        Returns the current user session including user profile data.
        Used by useSession() hook on the frontend.
      operationId: getSession
      security:
        - sessionCookie: []
      responses:
        '200':
          description: Session data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
        '401':
          description: No active session
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    type: "null"
                  user:
                    type: "null"

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: better-auth.session_token
      description: Session token stored in HTTP-only cookie

  schemas:
    SignUpRequest:
      type: object
      required:
        - email
        - password
        - name
        - programmingLevel
        - technologies
        - aiRoboticsExperience
        - hardwareAccess
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: User password
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Display name
        programmingLevel:
          $ref: '#/components/schemas/ProgrammingLevel'
        technologies:
          type: string
          description: JSON array of technology options
          example: '["Python", "ROS2", "AI/ML"]'
        aiRoboticsExperience:
          type: boolean
          description: Has AI/Robotics experience
        hardwareAccess:
          $ref: '#/components/schemas/HardwareAccess'
        devicesOwned:
          type: string
          nullable: true
          description: JSON array of devices (optional)
          example: '["Jetson", "GPU"]'

    SignInRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        rememberMe:
          type: boolean
          default: true
          description: Persist session across browser restarts
        callbackURL:
          type: string
          format: uri
          description: Redirect URL after authentication

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        session:
          $ref: '#/components/schemas/Session'

    SessionResponse:
      type: object
      properties:
        session:
          $ref: '#/components/schemas/Session'
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        emailVerified:
          type: boolean
        image:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        programmingLevel:
          $ref: '#/components/schemas/ProgrammingLevel'
        technologies:
          type: string
          description: JSON array string
        aiRoboticsExperience:
          type: boolean
        hardwareAccess:
          $ref: '#/components/schemas/HardwareAccess'
        devicesOwned:
          type: string
          nullable: true

    Session:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        expiresAt:
          type: string
          format: date-time
        ipAddress:
          type: string
          nullable: true
        userAgent:
          type: string
          nullable: true

    ProgrammingLevel:
      type: string
      enum:
        - beginner
        - intermediate
        - advanced
      description: User's programming experience level

    HardwareAccess:
      type: string
      enum:
        - none
        - simulator_only
        - real_robots
      description: User's hardware access level

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
