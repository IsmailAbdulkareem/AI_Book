"use strict";(globalThis.webpackChunkphysical_ai_robotics_book=globalThis.webpackChunkphysical_ai_robotics_book||[]).push([[301],{9301:(e,t,s)=>{s.r(t),s.d(t,{Chatbot:()=>v,default:()=>S});var n=s(6540);const a={chatIcon:"chatIcon_mNJO",chatIconSvg:"chatIconSvg_Ml98",chatIconClose:"chatIconClose_wY9S",chatPanel:"chatPanel_YkPL",slideUp:"slideUp_F8OC",panelHeader:"panelHeader_vvSE",panelTitle:"panelTitle_mYsh",closeButton:"closeButton_XR2n",messagesContainer:"messagesContainer_MjDf",message:"message_aF95",messageUser:"messageUser_RSIK",messageAssistant:"messageAssistant_zw50",messageError:"messageError_RPin",citation:"citation_wSbP",sourceList:"sourceList_r1Ep",sourceListTitle:"sourceListTitle_Qe2h",sourceItem:"sourceItem_wvyK",sourceNumber:"sourceNumber_URFQ",sourceContent:"sourceContent_WSlZ",sourceLink:"sourceLink_y9zi",inputArea:"inputArea_etJG",inputWrapper:"inputWrapper_O86M",textInput:"textInput_NibH",submitButton:"submitButton_jEAc",loadingIndicator:"loadingIndicator_Mbk9",loadingDots:"loadingDots_bHrE",loadingDot:"loadingDot_Vbex",bounce:"bounce_h5a7",welcomeContainer:"welcomeContainer_hQW8",welcomeTitle:"welcomeTitle_BLQx",welcomeText:"welcomeText_bDpf",exampleQuestions:"exampleQuestions_ULh9",exampleQuestion:"exampleQuestion_yiZs",errorContainer:"errorContainer_XB4r",errorText:"errorText_MZIN",retryButton:"retryButton_ZZIV",contextPreview:"contextPreview_kLoV",contextLabel:"contextLabel_WqYs",contextText:"contextText_WpZu",fadeIn:"fadeIn_UgSW",markdownContent:"markdownContent_cRxk",markdownParagraph:"markdownParagraph_KR_N",markdownHeader:"markdownHeader_XWPc",markdownList:"markdownList_s3rD",markdownLink:"markdownLink_CztZ",codeBlock:"codeBlock_SNiy",inlineCode:"inlineCode_TfqH",citationMarker:"citationMarker_XknM",referencesContainer:"referencesContainer_MLNX",referencesToggle:"referencesToggle_fd_U",referencesIcon:"referencesIcon_pPgM",referencesContent:"referencesContent_Hksj",referenceItem:"referenceItem_KI4p",referenceNumber:"referenceNumber_N0Mm",referenceLink:"referenceLink_b7W_",referenceTiming:"referenceTiming_jze4"};var r=s(4848);function o(){return(0,r.jsx)("svg",{className:a.chatIconSvg,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}function c(){return(0,r.jsx)("span",{className:a.chatIconClose,"aria-hidden":"true",children:"\xd7"})}const l=function({isOpen:e,onClick:t}){return(0,r.jsx)("button",{className:a.chatIcon,onClick:t,"aria-label":e?"Close chat":"Open chat","aria-expanded":e,type:"button",children:e?(0,r.jsx)(c,{}):(0,r.jsx)(o,{})})};function i(e){if(!e)return null;const t=[];let s=0;const n=/```(\w*)\n?([\s\S]*?)```/g;let o,c=0;const l=[];for(;null!==(o=n.exec(e));)o.index>c&&l.push({type:"text",content:e.slice(c,o.index)}),l.push({type:"codeblock",language:o[1]||"",content:o[2].trim()}),c=o.index+o[0].length;return c<e.length&&l.push({type:"text",content:e.slice(c)}),l.forEach((e,n)=>{if("codeblock"===e.type)t.push((0,r.jsx)("pre",{className:a.codeBlock,children:(0,r.jsx)("code",{className:e.language?a[`language-${e.language}`]:"",children:e.content})},s++));else{const n=e.content.split("\n");let o=!1,c=[];n.forEach((e,l)=>{const i=e.trim(),d=i.match(/^(\d+\.|[-*])\s+(.+)$/);if(d)o||(o=!0,c=[]),c.push(u(d[2],s++));else if(o&&c.length>0&&(t.push((0,r.jsx)("ul",{className:a.markdownList,children:c.map((e,t)=>(0,r.jsx)("li",{children:e},t))},s++)),o=!1,c=[]),""===i)l>0&&l<n.length-1&&t.push((0,r.jsx)("br",{},s++));else{const e=i.match(/^(#{1,6})\s+(.+)$/);if(e){const n=e[1].length,o=`h${Math.min(n+2,6)}`;t.push((0,r.jsx)(o,{className:a.markdownHeader,children:u(e[2],s++)},s++))}else t.push((0,r.jsx)("p",{className:a.markdownParagraph,children:u(i,s++)},s++))}}),o&&c.length>0&&t.push((0,r.jsx)("ul",{className:a.markdownList,children:c.map((e,t)=>(0,r.jsx)("li",{children:e},t))},s++))}}),t}function u(e,t=0){if(!e)return e;const s=[];let n=t;const o=/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*|\[[^\]]+\]\([^)]+\)|\[(\d+)\])/g;let c,l=0;for(;null!==(c=o.exec(e));){c.index>l&&s.push(e.slice(l,c.index));const t=c[0];if(t.startsWith("`")&&t.endsWith("`"))s.push((0,r.jsx)("code",{className:a.inlineCode,children:t.slice(1,-1)},n++));else if(t.startsWith("**")&&t.endsWith("**"))s.push((0,r.jsx)("strong",{children:t.slice(2,-2)},n++));else if(t.startsWith("*")&&t.endsWith("*"))s.push((0,r.jsx)("em",{children:t.slice(1,-1)},n++));else if(t.startsWith("[")&&t.includes("](")){const e=t.match(/\[([^\]]+)\]\(([^)]+)\)/);e&&s.push((0,r.jsx)("a",{href:e[2],target:"_blank",rel:"noopener noreferrer",className:a.markdownLink,children:e[1]},n++))}else/^\[\d+\]$/.test(t)&&s.push((0,r.jsx)("span",{className:a.citationMarker,children:t},n++));l=c.index+t.length}return l<e.length&&s.push(e.slice(l)),s.length>0?s:e}function d({sources:e,timing:t}){const[s,o]=(0,n.useState)(!1);return e&&0!==e.length?(0,r.jsxs)("div",{className:a.referencesContainer,children:[(0,r.jsxs)("button",{className:a.referencesToggle,onClick:()=>o(!s),type:"button","aria-expanded":s,children:[(0,r.jsx)("span",{className:a.referencesIcon,children:s?"\u25bc":"\u25b6"}),"References (",e.length,")"]}),s&&(0,r.jsxs)("div",{className:a.referencesContent,children:[e.map((e,t)=>(0,r.jsxs)("div",{className:a.referenceItem,children:[(0,r.jsxs)("span",{className:a.referenceNumber,children:["[",t+1,"]"]}),(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:a.referenceLink,children:m(e.url)})]},t)),t&&(0,r.jsxs)("div",{className:a.referenceTiming,children:["Retrieved in ",Math.round(t.retrieval_time_ms),"ms | Generated in ",Math.round(t.generation_time_ms),"ms"]})]})]}):null}function m(e){try{const t=new URL(e),s=t.pathname.split("/").filter(Boolean);if(s.length>0){return s[s.length-1].replace(/\.(html|md|mdx)$/i,"").replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return t.hostname}catch{return e}}const h=function({message:e}){const{role:t,content:s,sources:n,timing:o,error:c}=e,l="user"===t,u=!!c,m=[a.message,l?a.messageUser:a.messageAssistant,u&&a.messageError].filter(Boolean).join(" ");return(0,r.jsx)("div",{className:m,role:"article","aria-label":`${t} message`,children:u?(0,r.jsx)("span",{children:c}):l?(0,r.jsx)("span",{children:s}):(0,r.jsxs)("div",{className:a.markdownContent,children:[i(s),(0,r.jsx)(d,{sources:n,timing:o})]})})};var g=s(6588);const p={400:"Invalid request. Please try rephrasing your question.",404:"Service not found. Please try again later.",422:"Unable to process your question. Please try rephrasing.",429:"Too many requests. Please wait a moment and try again.",500:"Server error. Please try again later.",503:"Service temporarily unavailable. Please try again later.",timeout:"Request timed out. Please try again.",network:"Unable to connect to the server. Please check your connection.",default:"An unexpected error occurred. Please try again."};function x(e,t){return"AbortError"===e?.name?p.timeout:e?.message?.includes("Failed to fetch")||e?.message?.includes("NetworkError")?p.network:p[t]||p.default}function f(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null);let r="http://localhost:8000";try{const e=(0,g.P_)("docusaurus-plugin-chatbot");e?.apiUrl&&(r=e.apiUrl)}catch{}return{askQuestion:(0,n.useCallback)(async(e,s,n=5)=>{t(!0),a(null);const o=new AbortController,c=setTimeout(()=>o.abort(),3e4);try{const t=await fetch(`${r}/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,...s&&{context:s},top_k:n}),signal:o.signal});if(clearTimeout(c),!t.ok){const e=await t.json().catch(()=>({})),s=x(null,t.status);throw a(s),new Error(e.detail||s)}return await t.json()}catch(l){clearTimeout(c);const e=x(l,null);throw a(e),l}finally{t(!1)}},[r]),checkHealth:(0,n.useCallback)(async()=>{try{return(await fetch(`${r}/health`,{method:"GET"})).ok}catch{return!1}},[r]),isLoading:e,error:s,clearError:(0,n.useCallback)(()=>{a(null)},[])}}const b="rag-chatbot-session";function k(){const e=Date.now();return{messages:[],createdAt:e,lastUpdatedAt:e}}function _(){const[e,t]=(0,n.useState)(k),[s,a]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=function(){try{const e=sessionStorage.getItem(b);if(e){const t=JSON.parse(e);if(t&&Array.isArray(t.messages))return t}}catch(e){console.warn("Failed to read chat session from storage:",e)}return null}();e&&t(e),a(!0)},[]),(0,n.useEffect)(()=>{s&&function(e){try{sessionStorage.setItem(b,JSON.stringify(e))}catch(t){console.warn("Failed to save chat session to storage:",t)}}(e)},[e,s]);const r=(0,n.useCallback)(e=>{const s={...e,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};return t(e=>({...e,messages:[...e.messages,s],lastUpdatedAt:Date.now()})),s},[]),o=(0,n.useCallback)(e=>{t(t=>{const s=[...t.messages];for(let n=s.length-1;n>=0;n--)if("assistant"===s[n].role){s[n]={...s[n],...e};break}return{...t,messages:s,lastUpdatedAt:Date.now()}})},[]),c=(0,n.useCallback)(()=>{const e=k();t(e);try{sessionStorage.removeItem(b)}catch(s){console.warn("Failed to clear session storage:",s)}},[]),l=e.messages.length;return{messages:e.messages,addMessage:r,updateLastAssistantMessage:o,clearSession:c,isLoaded:s,messageCount:l}}const j=["What is ROS 2?","How do I create a robot model with URDF?","What is the difference between Gazebo and Isaac Sim?"];function w(){return(0,r.jsxs)("div",{className:a.loadingIndicator,"aria-live":"polite",children:[(0,r.jsxs)("div",{className:a.loadingDots,children:[(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot}),(0,r.jsx)("span",{className:a.loadingDot})]}),(0,r.jsx)("span",{children:"Thinking..."})]})}function C({onQuestionClick:e}){return(0,r.jsxs)("div",{className:a.welcomeContainer,children:[(0,r.jsx)("h3",{className:a.welcomeTitle,children:"Ask me anything about the book!"}),(0,r.jsx)("p",{className:a.welcomeText,children:"I can help you understand Physical AI, ROS 2, robotics simulation, and more."}),(0,r.jsx)("div",{className:a.exampleQuestions,children:j.map((t,s)=>(0,r.jsx)("button",{className:a.exampleQuestion,onClick:()=>e(t),type:"button",children:t},s))})]})}function y({context:e,onClear:t}){if(!e)return null;const s=e.length>150?e.slice(0,150)+"...":e;return(0,r.jsxs)("div",{className:a.contextPreview,children:[(0,r.jsxs)("div",{className:a.contextLabel,children:["Selected text context:",(0,r.jsx)("button",{onClick:t,style:{marginLeft:"8px",background:"none",border:"none",cursor:"pointer",color:"inherit",textDecoration:"underline"},type:"button",children:"Clear"})]}),(0,r.jsx)("div",{className:a.contextText,children:s})]})}const N=function({onClose:e,selectedContext:t,onClearContext:s}){const[o,c]=(0,n.useState)(""),[l,i]=(0,n.useState)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),{messages:m,addMessage:g,isLoaded:p}=_(),{askQuestion:x,isLoading:b,error:k,clearError:j}=f();(0,n.useEffect)(()=>{u.current?.scrollIntoView({behavior:"smooth"})},[m,b]),(0,n.useEffect)(()=>{d.current?.focus()},[]);const N=(0,n.useCallback)(t=>{"Escape"===t.key&&e()},[e]),v=(0,n.useCallback)(async()=>{const e=o.trim();if(e&&!b){c(""),j(),i(null),g({role:"user",content:e});try{const n=await x(e,t);g({role:"assistant",content:n.answer,sources:n.sources,timing:{retrieval_time_ms:n.retrieval_time_ms,generation_time_ms:n.generation_time_ms}}),t&&s&&s()}catch(n){i(e),g({role:"assistant",content:"",error:k||"Failed to get response. Please try again."})}}},[o,b,x,g,t,s,j,k]),S=(0,n.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},[v]),I=(0,n.useCallback)(e=>{c(e),setTimeout(()=>{d.current?.focus()},100)},[]),T=(0,n.useCallback)(()=>{l&&(c(l),i(null),j())},[l,j]),L=0===m.length&&!b,P=o.trim().length>0&&!b;return(0,r.jsxs)("div",{className:a.chatPanel,role:"dialog","aria-label":"Chat with AI assistant",onKeyDown:N,children:[(0,r.jsxs)("div",{className:a.panelHeader,children:[(0,r.jsx)("h2",{className:a.panelTitle,children:"Ask about the book"}),(0,r.jsx)("button",{className:a.closeButton,onClick:e,"aria-label":"Close chat panel",type:"button",children:(0,r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),(0,r.jsxs)("div",{className:a.messagesContainer,role:"log","aria-live":"polite",children:[L&&!t?(0,r.jsx)(C,{onQuestionClick:I}):(0,r.jsx)(r.Fragment,{children:m.map((e,t)=>(0,r.jsx)(h,{message:e},e.id||t))}),b&&(0,r.jsx)(w,{}),k&&l&&(0,r.jsxs)("div",{className:a.errorContainer,children:[(0,r.jsx)("div",{className:a.errorText,children:k}),(0,r.jsx)("button",{className:a.retryButton,onClick:T,type:"button",children:"Retry"})]}),(0,r.jsx)("div",{ref:u})]}),(0,r.jsxs)("div",{className:a.inputArea,children:[(0,r.jsx)(y,{context:t,onClear:s}),(0,r.jsxs)("div",{className:a.inputWrapper,children:[(0,r.jsx)("textarea",{ref:d,className:a.textInput,value:o,onChange:e=>c(e.target.value),onKeyDown:S,placeholder:"Ask a question...","aria-label":"Type your question",rows:1,disabled:b}),(0,r.jsx)("button",{className:a.submitButton,onClick:v,disabled:!P,"aria-label":"Send message",type:"button",children:"Send"})]})]})]})};function v(){const[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null),o=(0,n.useCallback)(()=>{t(e=>!e)},[]),c=(0,n.useCallback)(()=>{t(!1)},[]),i=(0,n.useCallback)(e=>{a(e),t(!0)},[]),u=(0,n.useCallback)(()=>{a(null)},[]);return(0,n.useEffect)(()=>(window.__chatbotSetContext=i,()=>{delete window.__chatbotSetContext}),[i]),(0,n.useEffect)(()=>{const t=t=>{"Escape"===t.key&&e&&c()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{isOpen:e,onClick:o}),e&&(0,r.jsx)(N,{onClose:c,selectedContext:s,onClearContext:u})]})}const S=v}}]);